.SEG PRG $0200
.SEG DAT $0300

; IO $0400
;       00-16 MEXTIO
;       17	  Display

MACRO INFL
_INF_LOOP:
	JMP _INF_LOOP
/MACRO

ADDR_ABS_ROTH = $0400
ADDR_ABS_ROTL = $0401
ADDR_ORD_ROTH = $0402
ADDR_ORD_ROTL = $0403
ADDR_ORD_MOVE = $0404
ADDR_DET_SEGM = $0405
ADDR_DET_GRAD = $0406
ADDR_FLAGS = $0407
ADDR_FLG_S = $0408
ADDR_FLG_U = $0409
ADDR_NOISE = $040A

FLAG_MOVING = 1
FLAG_ROTATING = 2
FLAG_GUN_READY = 4
FLAG_DET_SEGM = 8
FLAG_DET_GRAD = 16
FLAG_ORD_FIRE = 32
FLAG_NOISE = 64

; enabling noise
LDA #FLAG_NOISE
STA ADDR_FLG_S

; testing
JMP WAIT_UNTIL_MOVE_STOP

; firing test
WAIT_FOR_FIRE:
	LDA ADDR_FLAGS
	AND #FLAG_GUN_READY
	BEQ WAIT_FOR_FIRE

LDA #FLAG_ORD_FIRE
STA ADDR_FLG_S

; moving test
WAIT_UNTIL_MOVE_STOP:
	LDA ADDR_FLAGS
	AND #FLAG_MOVING
	BNE WAIT_UNTIL_MOVE_STOP

LDA #100
STA ADDR_ORD_MOVE

; rotation test
WAIT_UNTIL_ROT_STOP:
	LDA ADDR_FLAGS
	AND #FLAG_ROTATING
	BNE WAIT_UNTIL_ROT_STOP

LDA #0
STA ADDR_ORD_ROTH
LDA #130
STA ADDR_ORD_ROTL

JMP WAIT_FOR_FIRE


NOP
NOP
NOP
NOP
NOP
